# 弃用的模块

本文件夹包含一些实践没有成功的状态估计代码，留下这些代码给有兴趣的同学参考(当然本人写的代码也可能有bug),并且留下一些我个人的调参感悟

## CA运动模型

该模型与CV运动模型的参数个数相同，均为三个(测量噪声已经通过统计方法得到，详细处理见pose_estimate的README),即x,y,z三轴的过程噪声。以下分析CA模型不能很好地完成状态估计的原因。

1. 低通滤波的延迟性导致加速度的迟滞性十分严重，我们能够得到的数据只有位置，经过卡尔曼滤波之后，一阶项速度会有一点滞后，而二阶项会比速度滞后情况更加严重。该滞后相位由过程噪声和测量噪声决定，如果降低过程噪声和测量噪声的比值，即更相信预测值，加速度曲线会更加光滑，当然代价是滞后性越强;如果提高过程噪声和测量噪声的比值，即更相信测量值，那么高频噪声极易使加速度的值较大，导致状态估计的数值不符合实际。

## CT运动模型

这是一个关于反陀螺的完全失败的模型探究。CT模型是一个研究圆周运动的模型，于是一个很自然的想法是，我能不能通过敌方小陀螺两个装甲板切换之间的轨迹点(认为是近似圆的轨迹)，利用卡尔曼滤波计算每一个时刻的x,y轴速度以及旋转角速度。如果得到旋转角速度后，假设敌方是匀速小陀螺状态，那么在下一次两个装甲板切换的时候，保持旋转角速度不变，x,y轴的速度沿着旋转方向逆方向旋转90度，那么就能得到一个关于小陀螺的卡尔曼滤波状态估计模型。

但是，在两个装甲板切换的前后一小段时间内，单目相机的观测值是十分糟糕的，因为过于倾斜的装甲板可能会导致部分灯条不可见，利用四点的PNP算法计算得到的结果与实际有所偏差，卡尔曼滤波得到的x,y轴速度也和实际大相径庭，这时候，如果仅仅将速度沿着旋转方向逆方向旋转90度，也会将错误的速度数据传递给下一个周期。但是，如果每次切换的时候将x,y轴速度置0,那么x,y轴的速度会经过相当一段时间后才能收敛，对于旋转得稍微快一点的模型，状态估计都无能为力。

## Singer模型

Singer模型可以看作是CV模型和CA模型以一定比例混合的模型，而参数alpha可以视为混合比例。相比于CV运动模型，Singer模型(当然这里指的是其变种当前统计模型)多了四个参数，分别为alpha和三个轴的最大加速度。对于Singer模型,我认为可能会存在以下几个问题。

1. Singer模型虽然能自由分配CV模型和CA模型的比例，但是，这个比例毕竟是固定的，对于运动状态变化较大的哨兵未必适用，这点比不上IMM模型(可以在观测过程变化CV模型和CA模型的比例)。而且，难以调整alpha这个参数。

2. 三个轴的最大加速度参数也很难调，对于不同的哨兵这个参数也应当不同。

3. 效果也未见得会比CV运动模型要好，如果参数调整得不够好的话，滤波很容易出问题，而CV模型却能在大部分时间(难怕参数只是随便调调)，都能有一个比较稳定的滤波。参数变多极大地提高了工作量，而且对调参侠的理论功底要求更高。

## 状态估计总结

对于击打哨兵而言，大部分时间都可以认为是匀速状态(这点可以通过s-t图比较清晰地看出来)，此时我认为使用匀速CV运动模型已经是最优解。难点在于哨兵变向的阶段，匀速CV模型会经过一段较长的收敛阶段(强跟踪滤波STF能一定程度减短这个收敛时间)，我认为一定程度上缓解这个问题有以下的几种方法：

1. 选择弹速优先，并且将弹速调整到稳定在28m/s上下，有较好的弹道，确保无论己方步兵在哨兵的哪个方向只要识别到都能打到哨兵(即静止标定)。(弹速优先是解决哨兵变向问题的关键，减短预测时间，就能减短预测距离，如果将预测距离缩短至半个大装甲板之内的话，理论上就有100%的命中率)。
2. 贴脸输出(还是减短预测时间)
3. 优秀的控制
4. 上供弹(减短发射延迟时间)

总而言之，我认为匀速CV模型完全能够成为一个优秀的状态估计角色,与其研究其它一些复杂的算法，不如静下心来，将基础的算法理解清晰(痛的领悟)。