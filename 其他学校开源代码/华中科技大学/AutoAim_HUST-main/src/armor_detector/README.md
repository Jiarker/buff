# 装甲板识别模块

1. 图像预处理

图像预处理使用的方法预处理是先将RGB通道图转为灰度图，然后对灰度图进行二值化。我们也尝试过不少预处理的办法，但相比其它通道相减的方法，这个方法不容易在高曝光条件之下灯条断开导致掉识别。

2. 灯条筛选

- 首先是灯条颜色的筛选，由于灰度图二值化并未考虑灯条颜色，故此处需要将灯条所在的ROI抠出来，然后计算区域内各通道平均灰度值，以此来判断灯条的颜色，筛选掉一部分无用的灯条。

- 几何条件筛选

筛选的几何条件主要包含如下:
1. 灯条角度
2. 灯条面积
3. 灯条长宽比

## 装甲板筛选

装甲板筛选的几何条件如下:

1. 两灯条角度差
2. 装甲板长宽比
3. 两灯条中心像素差
4. 两灯条拼成的四边形和矩形相似程度
5. 两灯条长度比
6. 装甲板面积

## 数字分类

将筛选得到的装甲板放进分类器分类，数字分类器使用的是Hog+SVM分类器，分类得到的结果是几号装甲板(不是装甲板即为0号)，详细内容参考该算法。训练脚本均已开源。

# 反陀螺模块

这套代码包含两种反陀螺策略，以下逐一分析

1. 云台不动的反陀螺模式

在敌方转速较快的情况下，如果进行云台跟随，云台来回抖动十分频繁，导致云台长期处于变向转台，命中率很低。这时候可以计算敌方小陀螺的运动周期，当当前时间加上预测时间正好等于小陀螺运动到下一个周期正中间的时候，打出一梭子。

于是这个算法最重要的便是如何计算小陀螺的运动周期。我们采用的办法是卡方检验，通过卡方检验来判断装甲板切换，每两次装甲板切换之间的时间为一个周期。通过对周期进行一阶低通滤波，得到最终的所估计得到的周期。由于卡方检验判断装甲板切换相当准确，所以该方法在估计周期也较为准确。不足的是，即便是估计对周期，机械结构发射延迟的不稳定同样会影响命中率。同时，该算法对变速的小陀螺命中率可以说是断崖式下降。

2. 云台运动的反陀螺模式

如果敌方小陀螺旋转较慢，那么云台跟随将是一种效率更高的方式。对于无平移的小陀螺，我们采用了一种比较简单的方法，如果设当前时间$t_1$,看到装甲板位置为$s$,运动周期为$T$(我们的周期通过卡方检验测得),,那么估计$\Delta t$时间之后的位置应该是
$$ 
    s_{'} = s + (s_{t_1 - T + \Delta t} - s_{t_1 - T}) 
$$

![](../../pic/1.jpg)

上图中红色是预测0.4s之后yaw的曲线，蓝色为实际yaw的曲线

移动反小陀螺算法尚未开发成功